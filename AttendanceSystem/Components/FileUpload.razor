@using Microsoft.AspNetCore.Components.Forms

<h4>Upload Student File</h4>

<InputFile OnChange="HandleFileUpload" accept=".txt" />
<p>@statusMessage</p>



@code {
    private List<string> fileContentLines = new();
    private string statusMessage = "";

    private async Task HandleFileUpload(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file == null)
        {
            statusMessage = "No file selected.";
            return;
        }

        //Ensure the file is a .txt file
        if (file.Name.EndsWith(".txt", StringComparison.OrdinalIgnoreCase))
        {
            using var stream = file.OpenReadStream();
            using var reader = new StreamReader(stream);

            fileContentLines.Clear();
            bool isFirstLine = true;

            while (!reader.EndOfStream)
            {
                var line = await reader.ReadLineAsync();

                //Trim whitespace
                line = line?.Trim(); 

                //If the line is empty after trimming, skip it
                if (string.IsNullOrWhiteSpace(line)) continue;

                //Skip header line
                if (isFirstLine)
                {
                    isFirstLine = false;
                    continue;
                }

                //Split the line by tabs (assuming it's a TSV)
                var fields = line.Split('\t');

                //Assuming there are 4 fields in each line (Last Name, First Name, Username, Student ID)
                var studentRecord = $"Last Name: {fields[0]}, First Name: {fields[1]}, Username: {fields[2]}, Student ID: {fields[3]}";

                //Add the formatted student record to the list
                fileContentLines.Add(studentRecord);
            }

            statusMessage += $" Uploaded";
        }
        else
        {
            statusMessage = "Please upload a .txt file.";
        }
    }
}
